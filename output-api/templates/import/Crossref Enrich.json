{
  "id": 2,
  "workflow_id": "dd5618ae-ad8b-41da-9331-17733e5ebda7",
  "label": "Crossref Enrich",
  "version": 1,
  "created_at": "2026-02-05T16:31:04.248Z",
  "modified_at": "2026-02-07T11:16:20.690Z",
  "published_at": "2026-02-07T11:16:20.664Z",
  "deleted_at": null,
  "description": "Crossref DOI Query",
  "strategy_type": 3,
  "strategy": {
    "format": "json",
    "url_doi": "https://api.crossref.org/works/[doi]",
    "delayInMs": 0,
    "get_doi_item": "$.message",
    "parallelCalls": 1,
    "exclusion_criteria": "$contains($.pub_type,\"posted-content\") or $contains($.pub_type,\"peer-review\")",
    "only_import_if_authors_inst": true
  },
  "mapping": "(\r\n    $cfg := params.cfg;\r\n    $tags := $cfg.affiliation_tags;\r\n    $date_builder := function($array) {(\r\n        $year  := $array[0];\r\n        $month := $array[1] ? $array[1] : 1;\r\n        $day   := $array[2] ? $array[2] : 1;\r\n        $year & \"-\" & $pad($string($month), -2, \"0\") & \"-\" & $pad($string($day),-2, \"0\");\r\n    )};\r\n{\r\n    \"title\": $.title[0],\r\n    \"doi\": $.DOI,\r\n    \"oa_category\": $.license ? \"gold\" : ($.isHybrid ? \"hybrid\" : \"closed\"),\r\n    \"authors_inst\": $.author[\r\n      (\r\n      $hits := $filter(affiliation, function($aff) {\r\n        $count(\r\n          $filter($tags, function($tag) {\r\n            $contains($lowercase($aff.name), $lowercase($tag))\r\n          })\r\n        ) > 0\r\n      });\r\n      $count($hits) > 0\r\n    )\r\n        ].{\r\n        \"first_name\": given,\r\n        \"last_name\": family,\r\n        \"orcid\": ORCID,\r\n        \"affiliation\": affiliation[(\r\n                $hits := $filter(name, function($aff) {\r\n                    $count(\r\n                    $filter($tags, function($tag) {\r\n                        $contains($lowercase($aff), $lowercase($tag))\r\n                    })\r\n                    ) > 0\r\n                });\r\n                $count($hits) > 0\r\n                )][0].name\r\n        }[],\r\n    \"authors\": $join($.author.($string(given & \" \" & family)), \"; \"),\r\n    \"greater_entity\": {\r\n      \"label\": $.\"container-title\"[0],\r\n      \"identifiers\": $.ISSN.{\r\n        \"type\" : \"issn\",\r\n        \"value\" : $\r\n      }\r\n    },\r\n    \"publisher\": {\r\n      \"label\": $.publisher\r\n    },\r\n    \"pub_date\": (\r\n        $dp := $.\"published-online\".\"date-parts\"[0];\r\n        $dp ? $date_builder($dp)\r\n        ),\r\n    \"pub_date_print\": (\r\n        $dp := $.\"published-print\".\"date-parts\"[0];\r\n        $dp ? $date_builder($dp)\r\n        ),\r\n    \"pub_date_accepted\": (\r\n        $dp := $.\"approved\" ? $.\"approved\".\"date-parts\"[0] : $.\"accepted\".\"date-parts\"[0];\r\n        $dp ? $date_builder($dp)\r\n        ),\r\n    \"language\": $.language,\r\n    \"link\": $.URL,\r\n    \"funder\": $.funder[].{\r\n        \"label\": name,\r\n        \"doi\": DOI\r\n    },\r\n    \"pub_type\": $.type,\r\n    \"license\": (\r\n        $url := $.license[$lookup($, \"content-version\")=\"vor\"].URL;\r\n        $url ? ($contains($string($url), \"creativecommons.org/licenses/by/\") ? 'cc-by' : (\r\n            $contains($string($url), \"creativecommons.org/licenses/by-nc/\") ? 'cc-by-nc' : (\r\n                $contains($string($url), \"creativecommons.org/licenses/by-nc-nd/\") ? 'cc-by-nc-nd' : null\r\n            )\r\n        )) : null\r\n    ),\r\n    \"status\": 1,\r\n    \"abstract\": $.abstract,\r\n    \"page_count\": (\r\n        $p := $.page;\r\n        /* Bereich \"start-end\" nur mit Ziffern */\r\n        $range := $match($p, /^(\\d+)\\s*-\\s*(\\d+)$/);\r\n        /* Einzelne Seite nur Ziffern */\r\n        $single := $match($p, /^(\\d+)$/);\r\n\r\n        $range ? (\r\n            $start := $number($range[0].groups[0]);\r\n            $end := $number($range[0].groups[1]);\r\n            $end - $start + 1\r\n            )\r\n        : ($single ? 1 : null)\r\n        )\r\n}\r\n)",
  "update_config": {
    "doi": 2,
    "link": 2,
    "title": 2,
    "funder": 3,
    "status": 2,
    "authors": 2,
    "invoice": 2,
    "license": 2,
    "abstract": 2,
    "citation": 2,
    "contract": 2,
    "language": 2,
    "pub_date": 2,
    "pub_type": 2,
    "publisher": 2,
    "page_count": 2,
    "author_inst": 3,
    "oa_category": 2,
    "cost_approach": 2,
    "peer_reviewed": 2,
    "greater_entity": 2
  },
  "locked_at": null
}