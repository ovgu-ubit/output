{
  "id": 12,
  "workflow_id": "95ab5d93-113e-4ae9-8803-18525dc1833d",
  "label": "Scopus Import",
  "version": 1,
  "created_at": "2026-02-09T13:41:27.063Z",
  "modified_at": "2026-02-09T13:41:52.305Z",
  "published_at": "2026-02-09T13:41:52.298Z",
  "deleted_at": null,
  "description": "Scopus Import via URL Query",
  "strategy_type": 2,
  "strategy": {
    "format": "json",
    "max_res": 20,
    "delayInMs": 0,
    "get_count": "$.\"search-results\".\"opensearch:totalResults\"",
    "get_items": "$.\"search-results\".entry",
    "url_count": "https://api.elsevier.com/content/search/scopus?query=AFFIL('[affiliation_tags]')+and+PUBYEAR+IS+[year]&view=complete&apiKey=[SECRET_SCOPUS]&httpAccept=application/json",
    "url_items": "https://api.elsevier.com/content/search/scopus?query=AFFIL('[affiliation_tags]')+and+PUBYEAR+IS+[year]&view=complete&apiKey=[SECRET_SCOPUS]&httpAccept=application/json",
    "offset_name": "start",
    "max_res_name": "count",
    "offset_count": 0,
    "offset_start": 0,
    "request_mode": "offset",
    "parallelCalls": 2,
    "exclusion_criteria": "false",
    "search_text_combiner": " or ",
    "only_import_if_authors_inst": true
  },
  "mapping": "(\n  $cfg := params.cfg;\n  $tags := $cfg.affiliation_tags;\n  $tagHit := function($s) {\n    $count(\n      $filter($tags, function($t) {\n        $contains($lowercase($s), $lowercase($t))\n      })\n    ) > 0\n    };\n  /* afid -> affilname lookup map */\n  $affById := $merge(\n    $.affiliation.{ ($.afid): $.affilname }\n  );\n  /* alle Affiliations (IDs), deren Name zu Tags passt */\n  $hitAfids := $.affiliation[$tagHit(affilname)].afid;\n  {\n      \"title\": $.\"dc:title\",\n      \"doi\": $.\"prism:doi\",\n      \"authors_inst\": $.author[\n          $count(\n                $filter($.afid.\"$\", function($id) { $id in $hitAfids })\n            ) > 0\n      ].{\n            \"first_name\": $.\"given-name\",\n            \"last_name\": surname,\n            \"orcid\": ORCID,\n            \"affiliation\": $join($distinct(\n                $map(\n                    $.afid.\"$\"[$ in $hitAfids],\n                    function($id) { $lookup($affById, $id) }\n                    )\n                ),\"; \")\n        }[],\n      \"authors\": $join($.author.(surname? surname & \", \" & $.\"given-name\" : authname), \"; \"),\n      \"greater_entity\": {\n        \"label\": $.\"prism:publicationName\",\n        \"identifiers\": $append($append($.\"prism:issn\".{\n            \"type\": \"issn\",\n            \"value\": $.$substring(0,4) & \"-\" & $.$substring(4,8)\n        }, $.\"prism:eIssn\".{\n            \"type\": \"issn\",\n            \"value\": $.$substring(0,4) & \"-\" & $.$substring(4,8)\n        }), $.\"prism:isbn\".{\n            \"type\": \"isbn\",\n            \"value\": $\n        })\n      },\n      \"pub_date\": $.\"prism:coverDate\",\n      \"pub_type\": $.subtypeDescription,\n      \"status\": 1,\n      \"volume\": $.\"prism:volume\",\n      \"issue\" : $.\"prism:issueIdentifier\",\n      \"article_number\": $.\"article_number\",\n      \"first_page\" : (\n           $range := $.\"prism:pageRange\" ? $match($.\"prism:pageRange\", /^.+-.+$/) : null;\n           $range ? (\n            $split := $split($.\"prism:pageRange\",\"-\");\n            $split[0]\n            ) : undefined;\n      ),\n      \"last_page\" : (\n           $range := $.\"prism:pageRange\" ? $match($.\"prism:pageRange\", /^.+-.+$/) : null;\n           $range ? (\n            $split := $split($.\"prism:pageRange\",\"-\");\n            $split[1]\n            ) : undefined;\n      ),\n      \"page_count\": (\n          $range := $.\"prism:pageRange\" ? $match($.\"prism:pageRange\", /^(\\d+)\\s*-\\s*(\\d+)$/) : null;\n          $range ? (\n            $split := $split($.\"prism:pageRange\",\"-\");\n            $number($split[1]) - $number($split[0]) + 1;\n            ) : undefined;\n      ),\n      \"abstract\": $.\"dc:description\"\n  }\n)",
  "update_config": {
    "doi": 2,
    "link": 2,
    "title": 2,
    "funder": 3,
    "status": 2,
    "authors": 2,
    "invoice": 2,
    "license": 2,
    "abstract": 2,
    "citation": 2,
    "contract": 2,
    "language": 2,
    "pub_date": 2,
    "pub_type": 2,
    "publisher": 2,
    "page_count": 2,
    "author_inst": 0,
    "oa_category": 2,
    "cost_approach": 2,
    "peer_reviewed": 2,
    "greater_entity": 2
  },
  "locked_at": null
}