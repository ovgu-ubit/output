{
  "id": 1,
  "workflow_id": "4ab99544-7da4-403c-bf83-afb139d750c9",
  "label": "Crossref Import",
  "version": 1,
  "created_at": "2026-01-23T10:13:16.003Z",
  "modified_at": "2026-02-05T12:32:29.972Z",
  "published_at": "2026-02-05T12:32:29.960Z",
  "deleted_at": null,
  "description": "Query Import of Crossref",
  "strategy_type": 2,
  "strategy": {
    "format": "json",
    "max_res": 20,
    "delayInMs": 0,
    "get_count": "$.message.\"total-results\"",
    "get_items": "$.message.items",
    "url_count": "https://api.crossref.org/works?query.affiliation=[search_tags]&query.bibliographic=[year]&sort=indexed",
    "url_items": "https://api.crossref.org/works?query.affiliation=[search_tags]&query.bibliographic=[year]&sort=indexed",
    "offset_name": "offset",
    "max_res_name": "rows",
    "offset_count": 0,
    "offset_start": 0,
    "request_mode": "offset",
    "parallelCalls": 1,
    "exclusion_criteria": "$contains($.pub_type,\"posted-content\") or $contains($.pub_type,\"peer-review\")",
    "search_text_combiner": "+",
    "only_import_if_authors_inst": true
  },
  "mapping": "(\n    $cfg := params.cfg;\n    $tags := $cfg.affiliation_tags;\n    $date_builder := function($array) {(\n        $year  := $array[0];\n        $month := $array[1] ? $array[1] : 1;\n        $day   := $array[2] ? $array[2] : 1;\n        $year & \"-\" & $pad($string($month), -2, \"0\") & \"-\" & $pad($string($day),-2, \"0\");\n    )};\n{\n    \"title\": $.title[0],\n    \"doi\": $.DOI,\n    \"oa_category\": $.license ? \"gold\" : ($.isHybrid ? \"hybrid\" : \"closed\"),\n    \"authors_inst\": $.author[\n      (\n      $hits := $filter(affiliation, function($aff) {\n        $count(\n          $filter($tags, function($tag) {\n            $contains($lowercase($aff.name), $lowercase($tag))\n          })\n        ) > 0\n      });\n      $count($hits) > 0\n    )\n        ].{\n        \"first_name\": given,\n        \"last_name\": family,\n        \"orcid\": ORCID,\n        \"affiliation\": affiliation[(\n                $hits := $filter(name, function($aff) {\n                    $count(\n                    $filter($tags, function($tag) {\n                        $contains($lowercase($aff), $lowercase($tag))\n                    })\n                    ) > 0\n                });\n                $count($hits) > 0\n                )][0].name\n        }[],\n    \"authors\": $join($.author.($string(given & \" \" & family)), \"; \"),\n    \"greater_entity\": {\n      \"label\": $.\"container-title\"[0],\n      \"identifiers\": $.ISSN.{\n        \"type\" : \"issn\",\n        \"value\" : $\n      }\n    },\n    \"publisher\": {\n      \"label\": $.publisher\n    },\n    \"pub_date\": (\n        $dp := $.\"published-online\".\"date-parts\"[0];\n        $dp ? $date_builder($dp)\n        ),\n    \"pub_date_print\": (\n        $dp := $.\"published-print\".\"date-parts\"[0];\n        $dp ? $date_builder($dp)\n        ),\n    \"pub_date_accepted\": (\n        $dp := $.\"approved\" ? $.\"approved\".\"date-parts\"[0] : $.\"accepted\".\"date-parts\"[0];\n        $dp ? $date_builder($dp)\n        ),\n    \"language\": $.language,\n    \"link\": $.URL,\n    \"funder\": $.funder[].{\n        \"label\": name,\n        \"doi\": DOI\n    },\n    \"pub_type\": $.type,\n    \"license\": (\n        $url := $.license[$lookup($, \"content-version\")=\"vor\"].URL;\n        $url ? ($contains($string($url), \"creativecommons.org/licenses/by/\") ? 'cc-by' : (\n            $contains($string($url), \"creativecommons.org/licenses/by-nc/\") ? 'cc-by-nc' : (\n                $contains($string($url), \"creativecommons.org/licenses/by-nc-nd/\") ? 'cc-by-nc-nd' : null\n            )\n        )) : null\n    ),\n    \"status\": 1,\n    \"abstract\": $.abstract,\n    \"page_count\": (\n        $p := $.page;\n        /* Bereich \"start-end\" nur mit Ziffern */\n        $range := $match($p, /^(\\d+)\\s*-\\s*(\\d+)$/);\n        /* Einzelne Seite nur Ziffern */\n        $single := $match($p, /^(\\d+)$/);\n\n        $range ? (\n            $start := $number($range[0].groups[0]);\n            $end := $number($range[0].groups[1]);\n            $end - $start + 1\n            )\n        : ($single ? 1 : null)\n        )\n}\n)",
  "update_config": {
    "doi": 2,
    "link": 2,
    "title": 2,
    "funder": 3,
    "status": 2,
    "authors": 2,
    "invoice": 2,
    "license": 2,
    "abstract": 2,
    "citation": 2,
    "contract": 2,
    "language": 2,
    "pub_date": 2,
    "pub_type": 2,
    "publisher": 2,
    "page_count": 2,
    "author_inst": 3,
    "oa_category": 2,
    "cost_approach": 2,
    "peer_reviewed": 2,
    "greater_entity": 2
  },
  "locked_at": null
}